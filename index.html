<!DOCTYPE html>
<html lang="{{ language }}">
<head>
    <meta charset="UTF-8">
    <title>BI</title>
    <!-- Latest compiled and minified CSS -->
    <link rel="stylesheet" href='{{ hashed("/ui/bi/css/libs.css") }}'>

    <!-- card css -->
    <link rel="stylesheet" href='{{ hashed("/ui/bi/css/bi.css") }}'>
    <script src='{{ hashed("/ui/bi/libs/libs.js") }}'></script>
    <script src='/ui/bi/raven.min.js'></script>
    <!--<script src="/ui/pkg/dcjs/dc.min.js"></script>-->
    <!-- l10n -->
    <link rel="gettext" href='{{ hashed("/ui/" + name + "/translations/%s.json" % language) }}' lang="{{ language }}">
    <!-- Load application -->
    <script src='{{ hashed("/ui/common/gettext.js") }}'></script>
    <script src='{{ hashed("/ui/bi/bi.js") }}'></script>
</head>
<body>
<nav class="navbar navbar-default">
    <div class="container-fluid">
        <!-- Brand and toggle get grouped for better mobile display -->
        <div class="navbar-header">
            <button type="button" class="navbar-toggle collapsed" data-toggle="collapse"
                    data-target="#bs-example-navbar-collapse-1" aria-expanded="false">
                <span class="sr-only">Toggle navigation</span>
                <span class="icon-bar"></span>
                <span class="icon-bar"></span>
                <span class="icon-bar"></span>
            </button>
            <a class="navbar-brand" href="#">NOC BI</a>
        </div>

        <div class="collapse navbar-collapse" id="bs-example-navbar-collapse-1">

            <ul class="nav navbar-nav">
                <li class="dropdown">
                    <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" aria-haspopup="true"
                       aria-expanded="false"><span class="report-spinner" style="display: none;"><i
                            class="fa fa-spinner fa-spin fa-fw"></i></span>Oтчеты<span class="caret"></span></a>
                    <ul class="dropdown-menu report-menu">
                        <li>
                            <a id="reports" href="#" class="dropdown">Открыть</a>
                        </li>
                    </ul>
                </li>
                <li><a id="report-name"></a></li>
            </ul>
            <ul class="nav navbar-nav navbar-right">
                <li class="dropdown">
                    <a id="userBtn" href="#" class="dropdown-toggle" data-toggle="dropdown" role="button"
                       aria-haspopup="true" aria-expanded="false"></a>
                    <ul class="dropdown-menu">
                        <li id="about">
                            <a href="#" data-toggle="modal">
                                <i class="fa fa-question-circle" style="margin-right: 5px" aria-hidden="true"></i>О приложении</a></li>
                        <!--<li><a href="#"><i class="fa fa-cog" aria-hidden="true"></i> Setting</a></li>-->
                        <li>
                            <a href="#" onclick="console.error('error from BI')">Error Test</a>
                        </li>
                        <li role="separator" class="divider"></li>
                        <li><a href="/api/login/logout/"><i class="fa fa-sign-out" style="margin-right: 5px"
                                                            aria-hidden="true"></i>Выйти</a>
                        </li>
                    </ul>
                </li>
            </ul>
        </div>
        <!-- /.navbar-collapse -->
    </div>
    <!-- /.container-fluid -->
</nav>
<div class="row">
    <section class="col-md-12">
        <div id="dashboard"></div>
    </section>
</div>
<!-- </div> -->
<script>
    Raven.config('https://628e00405c90430f943895ef412919a5@sentry.center.rt.ru/4').install();
    $.get("/main/desktop/user_settings/", function(settings) {
        var displayName = [];

        if(settings.first_name) {
            displayName.push(settings.first_name);
        }
        if(settings.last_name) {
            displayName.push(settings.last_name);
        }
        if(displayName.length === 0) {
            displayName.push(settings.username);
        }
        $("<i class='fa fa-user' style='margin-right: 5px;' aria-hidden='true'></i> " + displayName.join(" ") + "<span class='caret'></span>").appendTo("#userBtn");
    });

    dashboard = new Dashboard("#dashboard");

    $('#reports').on('click', NocDialog.selectReportDlg);
    $('#about').on('click', NocDialog.aboutDlg);

    var query = $(location).attr('search').substr(1);
    if(query) {
        var params = deparam(query);
        if('id' in params) {
            $('.report-menu').append('<li class="divider save-menu"></li>\n<li><a id="save-btn" href="#" class="dropdown save-menu">Сохранить</a></li>\n<li><a id="save-as-btn" href="#" class="dropdown save-menu">Сохранить как</a></li>\n')
            $('#report-name').closest('li')
            //            .after('<li><a id="edit-btn" href="#" onclick="$(location).attr(\'pathname\',\'ui/bi/editor/board\');"> Edit</a></li>')
            .after('<li><a id="export-btn" href="#"><span class="spinner" style="display: none;"><i class="fa fa-spinner fa-spin fa-fw"></i></span>Экспорт<span\n        id="qty-rows" class="badge" style="margin-left: 5px;"></span></a></li>');
            $('#save-as-btn').on('click', NocDialog.saveAsReportDlg);
            dashboard.run(params.id);
        }
    }
</script>
</body>
</html>
